# Gemini チャットボット基本フレームワーク

Google Apps Script（GAS）とGemini APIを使用したシンプルなチャットボットアプリケーションです。

## 特徴

- ✅ Google Apps Scriptで動作するWebチャットインターフェース
- ✅ Gemini API（gemini-2.5-flash-lite）を使用
- ✅ スプレッドシートでシステムプロンプトを管理
- ✅ 会話ログの自動記録
- ✅ レスポンシブデザイン対応

## セットアップ手順

### 1. スプレッドシートのコピー

以下のテンプレートをコピーしてください：

https://docs.google.com/spreadsheets/d/1iQ4BpBpliQwFDFCkgzCxOT0cFyqESKQ3wysWgwyJADc/copy

コピー後、スプレッドシートには以下のシートが含まれています：
- **プロンプトシート** - セルA1にシステムプロンプトを設定
- **ログシート** - 会話履歴が自動的に記録されます

### 2. GASプロジェクトの作成

1. コピーしたスプレッドシートで **拡張機能 > Apps Script** を開く
2. Apps Scriptエディタが開きます

### 3. コードのコピー

Apps Scriptエディタで以下のファイルを作成し、このリポジトリの内容をコピーしてください：

1. **コード.gs** （または コード.js）
   - `コード.js` の内容をコピー

2. **index.html**
   - `index.html` の内容をコピー

3. **script.html**
   - `script.html` の内容をコピー

4. **style.css.html**
   - `style.css.html` の内容をコピー

### 4. Gemini APIキーの取得

1. [Google AI Studio](https://aistudio.google.com/app/api-keys) にアクセス
2. **Get API Key** をクリック
3. 新しいAPIキーを作成
4. 取得したAPIキーを次のステップで設定します

### 5. APIキーの設定

Apps Scriptエディタで：

1. ⚙️ **プロジェクトの設定** をクリック
2. **スクリプト プロパティ** タブを選択
3. **スクリプト プロパティを追加** をクリック
4. プロパティ: `GEMINI_API_KEY`
5. 値: 取得したGemini APIキーを貼り付け
6. **保存**

### 6. Webアプリのデプロイ

1. Apps Scriptエディタで **デプロイ > 新しいデプロイ** を選択
2. 種類を選択: **ウェブアプリ** を選択
3. 設定：
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: 全員
4. **デプロイ** をクリック
5. 承認プロセスを完了（初回のみ）
6. デプロイされたWebアプリのURLをコピー

## 使い方

1. デプロイしたWebアプリのURLをブラウザで開く
2. チャット画面が表示されます
3. メッセージを入力して **送信** ボタンをクリック
4. Gemini AIからの返信が表示されます

### システムプロンプトのカスタマイズ

スプレッドシートの **プロンプトシート** を開き、セルA1のテキストを編集してください。

デフォルト:
```
あなたは優しい相談相手です。親身になって会話をしてください。200文字程度
```

例:
```
あなたは親切なカスタマーサポート担当です。丁寧に質問に答えてください。
```

### 会話ログの確認

スプレッドシートの **ログシート** で全ての会話履歴を確認できます。

| 日時 | ユーザーメッセージ | ボット返信 |
|------|------------------|-----------|
| 2025-10-01 10:30:00 | こんにちは | こんにちは！何かお手伝いできることはありますか？ |

## ファイル構造

```
gemini-chatbot-basic-framework/
│
├── コード.js              # サーバーサイドロジック（GAS関数）
│   ├── doGet()           # Webアプリのエントリーポイント
│   ├── include()         # HTMLファイルのインクルード
│   ├── processMessage()  # メッセージ処理のメイン関数
│   ├── callGeminiAPI()   # Gemini API呼び出し
│   ├── getSystemPrompt() # スプレッドシートからプロンプト取得
│   └── logToSheet()      # 会話ログ記録
│
├── index.html            # メインHTMLテンプレート
│   └── include()でstyle.css.htmlとscript.htmlを読み込み
│
├── script.html           # クライアントサイドJavaScript
│   ├── 初期化処理
│   ├── sendMessage()     # メッセージ送信
│   ├── addMessage()      # メッセージ表示
│   └── google.script.run # GAS関数呼び出し
│
├── style.css.html        # CSSスタイル
│   ├── チャットUI
│   ├── メッセージバブル
│   └── レスポンシブデザイン
│
├── appsscript.json       # GASプロジェクト設定
│   ├── タイムゾーン: Asia/Tokyo
│   ├── ランタイム: V8
│   └── Webアプリ設定
│
├── CLAUDE.md             # Claude Code向け開発ガイド
└── README.md             # このファイル
```

### アーキテクチャ

```
┌─────────────────────────────────────────────┐
│          ブラウザ (index.html)              │
│  ┌──────────────┐      ┌─────────────────┐ │
│  │ script.html  │      │ style.css.html  │ │
│  │ (JavaScript) │      │     (CSS)       │ │
│  └──────┬───────┘      └─────────────────┘ │
└─────────┼───────────────────────────────────┘
          │ google.script.run
          ▼
┌─────────────────────────────────────────────┐
│     Google Apps Script (コード.js)          │
│  ┌──────────────────────────────────────┐   │
│  │ processMessage(userMessage)          │   │
│  │   ↓                                  │   │
│  │ getSystemPrompt() ← スプレッドシート  │   │
│  │   ↓                                  │   │
│  │ callGeminiAPI()                      │   │
│  │   ↓                                  │   │
│  │ logToSheet() → スプレッドシート        │   │
│  └──────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────┐
│         Gemini API                          │
│    (gemini-2.5-flash-lite)                  │
└─────────────────────────────────────────────┘
```

## カスタマイズ

### API設定の変更

`コード.js` の `callGeminiAPI()` 関数で設定を変更できます：

```javascript
generationConfig: {
    temperature: 0.7,        // 0.0-1.0 (創造性)
    maxOutputTokens: 1024,   // 最大出力トークン数
}
```

### UIのカスタマイズ

- **色の変更**: `style.css.html` の色コードを編集
- **レイアウト変更**: `index.html` と `style.css.html` を編集
- **動作変更**: `script.html` のJavaScriptを編集

## トラブルシューティング

### APIキーエラー
- スクリプトプロパティで `GEMINI_API_KEY` が正しく設定されているか確認
- Gemini APIキーが有効か確認

### ログが記録されない
- スプレッドシートに「ログシート」という名前のシートが存在するか確認
- シートの編集権限があるか確認

### デプロイエラー
- Webアプリの実行ユーザーが「自分」になっているか確認
- アクセス権限が適切に設定されているか確認

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。
